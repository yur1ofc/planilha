<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finan√ßas+ - Controle Financeiro Inteligente</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Firebase App (core) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1><i class="fas fa-piggy-bank"></i> Finan√ßas+</h1>
                <p>Controle suas finan√ßas de forma inteligente</p>
            </div>
            
            <div class="login-tabs">
                <button class="login-tab active" onclick="showLoginForm('login')">Entrar</button>
                <button class="login-tab" onclick="showLoginForm('register')">Cadastrar</button>
            </div>

            <!-- Formul√°rio de Login -->
            <form id="loginForm" class="login-form active">
                <div class="form-group">
                    <label for="loginEmail">E-mail</label>
                    <input type="email" id="loginEmail" required placeholder="seu@email.com">
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Senha</label>
                    <input type="password" id="loginPassword" required placeholder="Sua senha">
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
                
                <div class="login-links">
                    <a href="#" onclick="showForgotPassword()">Esqueci minha senha</a>
                </div>
            </form>

            <!-- Formul√°rio de Cadastro -->
            <form id="registerForm" class="login-form">
                <div class="form-group">
                    <label for="registerName">Nome completo</label>
                    <input type="text" id="registerName" required placeholder="Seu nome completo">
                </div>

                <div class="form-group">
                    <label for="registerNickname">Apelido/Nome de exibi√ß√£o</label>
                    <input type="text" id="registerNickname" required placeholder="Como quer ser chamado">
                </div>
                
                <div class="form-group">
                    <label for="registerEmail">E-mail</label>
                    <input type="email" id="registerEmail" required placeholder="seu@email.com">
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">Senha</label>
                    <input type="password" id="registerPassword" required placeholder="M√≠nimo 6 caracteres" minlength="6">
                </div>
                
                <div class="form-group">
                    <label for="registerConfirmPassword">Confirmar senha</label>
                    <input type="password" id="registerConfirmPassword" required placeholder="Digite novamente sua senha">
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-user-plus"></i> Criar conta
                </button>
            </form>
        </div>
    </div>

    <!-- Aplica√ß√£o Principal -->
    <div id="appContainer" class="app-container hidden">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1><i class="fas fa-piggy-bank"></i> Finan√ßas+</h1>
                <p>Seu controle financeiro</p>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#" class="sidebar-item active" onclick="showDashboardSection('overview')">
                    <i class="fas fa-chart-line"></i> Vis√£o Geral
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('transactions')">
                    <i class="fas fa-exchange-alt"></i> Transa√ß√µes
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('budget')">
                    <i class="fas fa-wallet"></i> Or√ßamento
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('goals')">
                    <i class="fas fa-bullseye"></i> Metas
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('investments')">
                    <i class="fas fa-chart-pie"></i> Investimentos
                </a>
                <a href="#" class="sidebar-item" onclick="showDashboardSection('reports')">
                    <i class="fas fa-file-alt"></i> Relat√≥rios
                </a>
            </nav>
        </div>

        <!-- Conte√∫do Principal -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1 id="dashboardTitle">Vis√£o Geral</h1>
                    <p id="dashboardSubtitle">Resumo completo das suas finan√ßas</p>
                </div>
                
                <div class="header-right">
                    <div class="user-info" onclick="toggleUserMenu()">
                        <div class="user-avatar" id="userAvatar">
                            <!-- Avatar ser√° carregado dinamicamente -->
                        </div>
                        <div class="user-details">
                            <div class="user-name" id="userName">Carregando...</div>
                            <div class="user-email" id="userEmail">carregando@email.com</div>
                        </div>
                        <button class="menu-toggle">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>

                <!-- Menu do Usu√°rio -->
                <div class="user-menu" id="userMenu">
                    <a href="#" class="user-menu-item" onclick="showProfileSettings()">
                        <i class="fas fa-user"></i> Minha Conta
                    </a>
                    <a href="#" class="user-menu-item" onclick="showAccountSettings()">
                        <i class="fas fa-cog"></i> Configura√ß√µes
                    </a>
                    <a href="#" class="user-menu-item" onclick="showPrivacySettings()">
                        <i class="fas fa-shield-alt"></i> Privacidade
                    </a>
                    <div class="user-menu-divider"></div>
                    <a href="#" class="user-menu-item" onclick="showAbout()">
                        <i class="fas fa-info-circle"></i> Sobre
                    </a>
                    <div class="user-menu-divider"></div>
                    <a href="#" class="user-menu-item text-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </a>
                </div>
            </header>

            <!-- Conte√∫do -->
            <div class="content">
                <!-- Question√°rio (apenas para novos usu√°rios) -->
                <div id="questionnaireContainer" class="hidden">
                    <div class="progress-bar">
                        <div class="progress" id="progressBar"></div>
                    </div>

                    <!-- Se√ß√µes do Question√°rio -->
                    <div class="section active" id="section1">
                        <h2>Perfil Financeiro</h2>
                        <p>Vamos come√ßar conhecendo melhor sua situa√ß√£o financeira atual.</p>
                        
                        <div class="question-group">
                            <div class="question">Qual sua situa√ß√£o habitacional?</div>
                            <div class="options">
                                <div class="option" onclick="selectOption(this)">Mora sozinho(a)</div>
                                <div class="option" onclick="selectOption(this)">Mora com os pais/familiares</div>
                                <div class="option" onclick="selectOption(this)">Mora com parceiro(a)/amigos</div>
                                <div class="option" onclick="selectOption(this)">Outro</div>
                            </div>
                        </div>
                        
                        <div class="navigation">
                            <div></div>
                            <button class="btn btn-primary" onclick="nextSection(1)">Pr√≥ximo</button>
                        </div>
                    </div>

                    <!-- ... outras se√ß√µes do question√°rio ... -->

                    <div class="section" id="section6">
                        <h2>Resumo e An√°lise</h2>
                        <p>Veja um resumo completo da sua situa√ß√£o financeira.</p>
                        
                        <div class="resumo-grid">
                            <div class="summary-card">
                                <h3>Resumo Mensal</h3>
                                <p>Total Receitas: <span class="summary-value positive" id="resumoReceitas">R$ 0,00</span></p>
                                <p>Total Despesas: <span class="summary-value negative" id="resumoDespesas">R$ 0,00</span></p>
                                <p>Saldo Final: <span class="summary-value" id="resumoSaldo">R$ 0,00</span></p>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="gastosChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="alert">
                            <strong>Recomenda√ß√£o:</strong> Tente economizar pelo menos 20% da sua renda para investimentos.
                        </div>
                        
                        <div class="navigation">
                            <button class="btn btn-secondary" onclick="prevSection(6)">Anterior</button>
                            <button class="btn btn-primary" onclick="finalizarQuestionario()">Finalizar e Ver Dashboard</button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard -->
                <div id="dashboard" class="dashboard">
                    <div class="dashboard-header">
                        <h2>Dashboard Financeiro</h2>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="reiniciarQuestionario()">Editar Question√°rio</button>
                            <button class="btn" onclick="exportarDados()">Exportar Dados</button>
                            <button class="btn btn-primary" onclick="gerarRelatorioPDF()">Gerar Relat√≥rio PDF</button>
                        </div>
                    </div>

                    <!-- Assistente Financeiro -->
                    <div class="assistente-section">
                        <div class="assistente-header">
                            <div class="assistente-avatar">$</div>
                            <div>
                                <h3>Assistente Financeiro</h3>
                                <p>Suas dicas personalizadas para economizar e investir</p>
                            </div>
                        </div>
                        <div class="assistente-mensagens" id="assistenteMensagens">
                            <!-- Mensagens ser√£o inseridas aqui -->
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card positive">
                            <h3>Saldo Atual</h3>
                            <div class="stat-value" id="dashboardSaldo">R$ 0,00</div>
                            <div class="stat-subvalue">+2,5% desde o √∫ltimo m√™s</div>
                        </div>
                        <div class="stat-card">
                            <h3>Receitas do M√™s</h3>
                            <div class="stat-value" id="dashboardReceitas">R$ 0,00</div>
                            <div class="stat-subvalue">Meta: R$ 4.000,00</div>
                        </div>
                        <div class="stat-card negative">
                            <h3>Despesas do M√™s</h3>
                            <div class="stat-value" id="dashboardDespesas">R$ 0,00</div>
                            <div class="stat-subvalue">64% da receita</div>
                        </div>
                        <div class="stat-card positive">
                            <h3>Investimentos</h3>
                            <div class="stat-value" id="dashboardInvestimentos">R$ 0,00</div>
                            <div class="stat-subvalue">+8,2% no √∫ltimo ano</div>
                        </div>
                    </div>

                    <!-- Navega√ß√£o do Dashboard -->
                    <div class="dashboard-nav">
                        <button class="tab-button active" onclick="showDashboardTab('visao-geral')">Vis√£o Geral</button>
                        <button class="tab-button" onclick="showDashboardTab('receitas')">Receitas</button>
                        <button class="tab-button" onclick="showDashboardTab('despesas')">Despesas</button>
                        <button class="tab-button" onclick="showDashboardTab('investimentos')">Investimentos</button>
                        <button class="tab-button" onclick="showDashboardTab('metas')">Metas</button>
                        <button class="tab-button" onclick="showDashboardTab('relatorios')">Relat√≥rios</button>
                    </div>

                    <!-- Se√ß√µes do Dashboard -->
                    <div class="dashboard-section active" id="visao-geral">
                        <div class="charts-grid">
                            <div class="chart-card">
                                <h3>Distribui√ß√£o de Gastos</h3>
                                <canvas id="distribuicaoGastosChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h3>Evolu√ß√£o Patrimonial</h3>
                                <canvas id="evolucaoPatrimonialChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-section" id="receitas">
                        <h3>Gerenciar Receitas</h3>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="abrirModalReceita()">+ Nova Receita</button>
                        </div>
                        <div class="data-table">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Descri√ß√£o</th>
                                        <th>Valor</th>
                                        <th>Categoria</th>
                                        <th>Data</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="receitasTable">
                                    <!-- Preenchido dinamicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="dashboard-section" id="despesas">
                        <h3>Gerenciar Despesas</h3>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="abrirModalDespesa()">+ Nova Despesa</button>
                        </div>
                        <div class="data-table">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Descri√ß√£o</th>
                                        <th>Valor</th>
                                        <th>Categoria</th>
                                        <th>Data</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="despesasTable">
                                    <!-- Preenchido dinamicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="dashboard-section" id="investimentos">
                        <h3>Gerenciar Investimentos</h3>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="abrirModalInvestimento()">+ Novo Investimento</button>
                        </div>
                        <div class="data-table">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Descri√ß√£o</th>
                                        <th>Valor Investido</th>
                                        <th>Tipo</th>
                                        <th>Rentabilidade</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="investimentosDashboardTable">
                                    <!-- Preenchido dinamicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="dashboard-section" id="metas">
                        <h3>Metas Financeiras</h3>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="abrirModalMeta()">+ Nova Meta</button>
                        </div>
                        <div id="metasContainer">
                            <!-- Metas ser√£o inseridas aqui -->
                        </div>
                    </div>

                    <div class="dashboard-section" id="relatorios">
                        <h3>Relat√≥rios e Exporta√ß√£o</h3>
                        <div class="relatorios-section">
                            <p>Gere relat√≥rios detalhados sobre sua situa√ß√£o financeira</p>
                            
                            <div class="relatorio-options">
                                <div class="relatorio-card" onclick="gerarRelatorioPDF('mensal')">
                                    <div class="relatorio-icon">üìä</div>
                                    <h4>Relat√≥rio Mensal</h4>
                                    <p>Resumo completo do m√™s atual</p>
                                </div>
                                
                                <div class="relatorio-card" onclick="gerarRelatorioPDF('anual')">
                                    <div class="relatorio-icon">üìà</div>
                                    <h4>Relat√≥rio Anual</h4>
                                    <p>Vis√£o geral do ano financeiro</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Perfil -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configura√ß√µes do Perfil</h2>
                <button class="close-modal" onclick="closeModal('profileModal')">&times;</button>
            </div>
            
            <div class="profile-settings">
                <div class="profile-header">
                    <div class="profile-avatar" onclick="triggerAvatarUpload()">
                        <div class="avatar-image" id="profileAvatar">
                            <!-- Avatar ser√° carregado dinamicamente -->
                        </div>
                        <div class="avatar-upload">
                            <i class="fas fa-camera"></i>
                        </div>
                        <input type="file" id="avatarUpload" accept="image/*" class="hidden" onchange="handleAvatarUpload(this)">
                    </div>
                    <div class="profile-info">
                        <h2 id="profileUserName">Usu√°rio</h2>
                        <p id="profileUserEmail">usuario@email.com</p>
                    </div>
                </div>

                <form id="profileForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileName">Nome Completo</label>
                            <input type="text" id="profileName" required>
                        </div>
                        <div class="form-group">
                            <label for="profileNickname">Apelido/Nome de exibi√ß√£o</label>
                            <input type="text" id="profileNickname" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="profileEmail">E-mail</label>
                        <input type="email" id="profileEmail" required>
                    </div>

                    <div class="navigation">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('profileModal')">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Altera√ß√µes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Configura√ß√µes -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configura√ß√µes da Conta</h2>
                <button class="close-modal" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            
            <div class="profile-settings">
                <h3>Prefer√™ncias</h3>
                <div class="form-group">
                    <label for="themeSelect">Tema</label>
                    <select id="themeSelect" onchange="changeTheme(this.value)">
                        <option value="light">Claro</option>
                        <option value="dark">Escuro</option>
                        <option value="auto">Autom√°tico</option>
                    </select>
                </div>
                
                <div class="navigation">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('settingsModal')">
                        Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Salvar Configura√ß√µes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Receitas -->
    <div class="modal" id="modalReceita">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalReceitaTitulo">Nova Receita</h3>
                <button class="close-modal" onclick="fecharModal('modalReceita')">&times;</button>
            </div>
            <form id="formReceita">
                <input type="hidden" id="receitaId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="receitaDescricao">Descri√ß√£o *</label>
                        <input type="text" id="receitaDescricao" required>
                    </div>
                    <div class="form-group">
                        <label for="receitaValor">Valor *</label>
                        <input type="number" id="receitaValor" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="receitaCategoria">Categoria</label>
                        <select id="receitaCategoria">
                            <option value="Sal√°rio">Sal√°rio</option>
                            <option value="Freelance">Freelance</option>
                            <option value="Investimentos">Investimentos</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="receitaData">Data</label>
                        <input type="date" id="receitaData">
                    </div>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modalReceita')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Receita</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Despesas -->
    <div class="modal" id="modalDespesa">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalDespesaTitulo">Nova Despesa</h3>
                <button class="close-modal" onclick="fecharModal('modalDespesa')">&times;</button>
            </div>
            <form id="formDespesa">
                <input type="hidden" id="despesaId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="despesaDescricao">Descri√ß√£o *</label>
                        <input type="text" id="despesaDescricao" required>
                    </div>
                    <div class="form-group">
                        <label for="despesaValor">Valor *</label>
                        <input type="number" id="despesaValor" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="despesaCategoria">Categoria *</label>
                        <select id="despesaCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="Moradia">Moradia</option>
                            <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                            <option value="Transporte">Transporte</option>
                            <option value="Sa√∫de">Sa√∫de</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="despesaData">Data</label>
                        <input type="date" id="despesaData">
                    </div>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modalDespesa')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Despesa</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Investimentos -->
    <div class="modal" id="modalInvestimento">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalInvestimentoTitulo">Novo Investimento</h3>
                <button class="close-modal" onclick="fecharModal('modalInvestimento')">&times;</button>
            </div>
            <form id="formInvestimento">
                <input type="hidden" id="investimentoId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="investimentoDescricao">Descri√ß√£o *</label>
                        <input type="text" id="investimentoDescricao" required>
                    </div>
                    <div class="form-group">
                        <label for="investimentoValor">Valor *</label>
                        <input type="number" id="investimentoValor" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="investimentoTipo">Tipo *</label>
                        <select id="investimentoTipo" required>
                            <option value="">Selecione...</option>
                            <option value="Poupan√ßa">Poupan√ßa</option>
                            <option value="CDB">CDB</option>
                            <option value="Tesouro Direto">Tesouro Direto</option>
                            <option value="A√ß√µes">A√ß√µes</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="investimentoRentabilidade">Rentabilidade (% ao ano)</label>
                        <input type="number" id="investimentoRentabilidade" step="0.01">
                    </div>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modalInvestimento')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Investimento</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Metas -->
    <div class="modal" id="modalMeta">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalMetaTitulo">Nova Meta Financeira</h3>
                <button class="close-modal" onclick="fecharModal('modalMeta')">&times;</button>
            </div>
            <form id="formMeta">
                <input type="hidden" id="metaId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="metaDescricao">Descri√ß√£o *</label>
                        <input type="text" id="metaDescricao" required>
                    </div>
                    <div class="form-group">
                        <label for="metaValor">Valor Total *</label>
                        <input type="number" id="metaValor" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="metaData">Data Limite</label>
                        <input type="date" id="metaData">
                    </div>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modalMeta')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Meta</button>
                </div>
            </form>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>
    <script src="script.js"></script>
</body>
</html>
